---
title: "GeneSet: Representing Gene Sets in the Tidyverse"
author: "Kayla Morrell"
date: "`r Sys.Date()`"
output:
    BiocStyle::html_document
package: GeneSet
vignette: >
    %\VignetteIndexEntry{GeneSet: Representing Gene Sets in the Tidyverse}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEndcoding{UTF-8}
---

# Introduction
`GeneSet` is a package that represents gene sets in a tibble format with the `tbl_geneset` class. Gene sets are read in and converted into a tibble format. From here, typical `dplyr` operations can be performed on the tibble gene set.

# Installation
Install the most recent version of Bioconductor:

```{r bioconductor, eval = FALSE}
if(!requireNamespace("BiocManager", quietly = TRUE))
    install.pacakges("BiocManager")
BiocManager::install("GeneSet")
```

The development version is also available for install from GitHub:

```{r github, eval = FALSE}
BiocManager::install("Kayla-Morrell/GeneSet")
```

Then load `GeneSet`:

```{r  load, message = FALSE}
library(GeneSet)
```
# GeneSet

## Input and Output

`GeneSet` can create a `tbl_geneset` using two different input methods. The first is to input named character vectors of gene sets. `tbl_geneset()` returns the vectors as `tbl_geneset` tibble containing two columns, `gene` and `set`.

```{r constructor}
tbl <- tbl_geneset(set1 = letters, set2 = LETTERS)
tbl
```

The second method of creating a `tbl_geneset` would be to read in `.gmt` files. Using `import()` a path to a downloaded `.gmt` file is read in and a `tbl_geneset` is returned. The example below uses a hallmark gene set downloaded from [GSEA][], which is also included with this package. This `tbl_geneset` also includes a `source` column for reference as to where the gene set came from.

[GSEA]: http://software.broadinstitute.org/gsea/index.jsp

```{r gmt}
gmtFile <- system.file(package = "GeneSet", "extdata", "hallmark.gene.symbol.gmt")
tbl2 <- import(gmtFile)
tbl2
```

<!-- example of export -->
`export()` allows for a `tbl_geneset` to be exported into a temporary file with the extention `.gmt`.

```{r export}
fl <- tempfile(fileext = ".gmt")
gmt <- export(tbl2, fl)
gmt
```
<!-- Advanced use (construct gmt file) -->

## Implemented functions (or functionality)

`GeneSet` adopts the use of many `dplyr` functions such as `filter()`, `select()`, `mutate()`, `group_by()`, `ungroup()`, `summarize()`, and `arrange()`.

```{r install, message = FALSE}
library(dplyr)
```

```{r examples}
tbl <- tbl_geneset(set1 = letters, set2 = LETTERS)
tbl
tbl %>% filter(gene == "a" | gene == "A")
tbl %>% mutate(pval = rnorm(dim(tbl)[1]))
tbl %>% group_by(set) %>% summarise(n = n())
```

# Case study
Next, we demonstrate the use of `GeneSet` with an experiement dataset `airway` from the package `airway`. This data is from an RNA-Seq experiment on airway smooth muscle (ASM) cell lines.

The first step is to load the library and the necessary data.

```{r airway, message = FALSE}
library("airway")
data("airway")
se <- airway
```

The pacakges `AnnotationDbi` and `org.Hs.eg.db` are used for the mapping of gene symbols, GO ids, and Entrez ids to the already established Ensembl ids in `airway`. These Ensembl ids are the rownames of `airway`.

```{r mapping, message = FALSE}
library("AnnotationDbi")
library("org.Hs.eg.db")

rowData(se)$symbol <- mapIds(org.Hs.eg.db, keys = rownames(se), column = "SYMBOL", keytype = "ENSEMBL", multiVals = "first")

rowData(se)$go <- mapIds(org.Hs.eg.db, keys = rownames(se), column = "GO", keytype = "ENSEMBL", multiVals = "first")

rowData(se)$entrez <- mapIds(org.Hs.eg.db, keys = rownames(se), column = "ENTREZID", keytype = "ENSEMBL", multiVals = "first")

rowData(se)
```

The library `KEGGREST` is a client interface to the KEGG REST server. KEGG contains pathway maps that represent interaction, reaction and relation networks for various biological processes and diseases. Since we are working with ASM data we thought it would be interesting to look into the pathway for asthma. In the code below, we find the name of the pathway associated with asthma, find the genes in that pathway, and create a tibble that holds the gene name, the pathway name, and the Ensembl id associated with that gene.

```{r kegg, message = FALSE}
library(KEGGREST)
path <- keggFind("pathway", "asthma")
asthma <- keggGet(paste0("hsa", gsub("[^\\d]+", "", names(path), perl = TRUE)))
tbl <- tbl_geneset(Asthma = asthma[[1]]$GENE[c(TRUE,FALSE)])
tbl <- tbl %>% mutate(ensembl = mapIds(org.Hs.eg.db, keys = tbl$gene, column = "ENSEMBL", keytype = "ENTREZID", multiVals = "first"))

tbl
```

With this asthma pathway gene set, we can now subset the `airway` data to contain only the genes in this pathway.

```{r subset}
se <- se[which(rownames(rowData(se)) %in% tbl$ensembl),]

se

rowData(se)
```
<!--- Need to think about multiple pathways...--->

# Session info

```{r}
sessionInfo()
```